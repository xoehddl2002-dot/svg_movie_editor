# SVG Movie Editor - AI 엔지니어링 계약

## 프로젝트 개요

SVG Movie Editor는 Next.js 기반의 웹 비디오 편집 애플리케이션입니다. SVG 템플릿을 기반으로 비디오, 오디오, 이미지, 텍스트, 도형 등 다양한 미디어 클립을 타임라인 상에 배치하고 편집하여 영상을 제작할 수 있는 도구입니다.

### 주요 목적
- SVG 템플릿 기반 비디오 편집
- 타임라인 기반 멀티트랙 편집
- 실시간 미리보기
- PNG 이미지 시퀀스 및 프로젝트 파일 내보내기

## 기술 스택

### 핵심 프레임워크
- **Next.js 16.1.6** (App Router)
- **React 19.2.3**
- **TypeScript 5**

### 상태 관리
- **Zustand 5.0.11** - 전역 상태 관리
  - 위치: `src/features/editor/store/useStore.ts`
  - 모든 편집 상태, 트랙, 클립, 타임라인 정보를 관리

### UI 라이브러리
- **Shadcn UI** - 접근성 있는 UI 컴포넌트 (Dialog, Select, Slider, Tabs 등)
- **Tailwind CSS 4** - 스타일링
- **Lucide React** - 아이콘

### 미디어 처리
- **FFmpeg** (`@ffmpeg/ffmpeg`, `fluent-ffmpeg`, `ffmpeg-static`) - 비디오 처리 및 프레임 추출
- **Wavesurfer.js 7.12.1** - 오디오 파형 편집
- **react-image-crop 11.0.10** - 이미지 크롭 기능

### 기타 라이브러리
- **uuid 13.0.0** - 고유 ID 생성


## 핵심 개념

### Track (트랙)
트랙은 클립을 담는 레이어입니다. 각 트랙은 특정 타입(video, audio, image, text, shape, mask)을 가질 수 있습니다.

### Clip (클립)
클립은 타임라인 상의 개별 미디어 요소입니다. 시작 시간, 길이, 위치, 크기, 회전 등 다양한 속성을 가집니다.


## 주요 기능 및 동작 방식

### 1. 템플릿 시스템
- 템플릿은 카테고리(F: Full HD, S: Story, T: Text Banner)별로 구분
- 카테고리에 따라 자동으로 적절한 종횡비 설정
- 템플릿 선택 시 `initProjectWithTemplate` 호출로 프로젝트 초기화
- JSON의 `image-list`를 사용하여 이미지 경로 매핑 (ID 기반 조회) 및 경로 보정

### 2. 타임라인 편집
- 드래그 앤 드롭으로 클립 이동 및 길이 조정
- 멀티트랙 지원 (각 트랙은 독립적인 레이어)
- 클립 선택 시 `TransformControls`로 위치/크기/회전 조정
- 줌 인/아웃으로 타임라인 세밀도 조정

### 3. 미리보기 및 재생
- `PreviewPlayer`에서 실시간 미리보기 제공
- `requestAnimationFrame`을 사용한 부드러운 재생
- 현재 시간(`currentTime`)에 따라 보이는 클립만 렌더링
- 클립의 변형(위치, 크기, 회전, 필터 등) 실시간 반영

### 4. 편집 모달
- 클립 클릭 시 각 클립 타입에 맞는 sidebar Tab 열림
- 클립 타입별 전용 에디터 제공:
  - **이미지**: 크롭, 필터 (밝기, 대비, 채도, 블러)
  - **비디오**: 크롭, 필터, 시작 오프셋
  - **오디오**: 볼륨, 파형 편집
  - **텍스트**: 내용, 폰트, 크기, 색상
  - **도형 (Shape)**
    - **아이콘**: SVG 경로 편집, 크기 조절, 회전 (색상 변경 불가)
    - **기본 도형**: SVG 경로 편집, 색상 변경, 크기 조절, 회전 (모든 속성 편집 가능)

### 5. 내보내기
- **PNG 시퀀스**: DOM을 PNG로 캡처하여 프레임별 이미지 생성 (비디오 제외 옵션 있음)
- **프로젝트 저장/불러오기**: JSON 형식으로 전체 프로젝트 상태 저장
  - 저장 시 현재 타임라인 위치도 함께 저장
  - 불러오기 시 자동으로 편집기 페이지로 이동

## AI 개발 시 중요한 규칙

### 1. 상태 관리
- ✅ **모든 편집 상태는 `useStore`를 통해 관리**
- ✅ 클립/트랙 변경 시 반드시 스토어의 액션 함수 사용 (`updateClip`, `addClip`, `removeClip` 등)
- ❌ 로컬 상태로 클립 정보 관리하지 않기 (동기화 문제 발생)

### 2. ID 생성 및 참조
- ✅ 새 클립/트랙 생성 시 `uuid`로 고유 ID 생성
- ✅ 클립 이동 시 `trackId` 필드 업데이트 필수
- ❌ ID 직접 생성하거나 중복 사용 금지

### 3. 시간 단위
- ✅ 모든 시간 값은 **초(seconds)** 단위 사용
- ✅ `currentTime`, `start`, `duration`, `mediaStart` 모두 초 단위
- ❌ 밀리초나 프레임 번호 사용 금지

### 4. 변형 및 좌표 시스템
- ✅ 위치(`x`, `y`)는 **프로젝트 좌표계** 기준 (픽셀 단위)
- ✅ 크롭은 **퍼센트(0-100)** 단위
- ✅ 모든 이미지(`image` 타입)는 기본적으로 crop `{ x: 0, y: 0, width: 100, height: 100 }`을 가짐 (전체 이미지 표시)
- ✅ 템플릿의 `g` 태그(clip-path 포함)는 크롭된 이미지로 처리하며, 내부 ID 참조는 해당 그룹(`element`) 범위 내에서 탐색
- ✅ 회전은 **도(degrees)** 단위
- ✅ 필터 값은 기본값이 1 (밝기, 대비, 채도), 블러는 0
- ❌ CSS 변형과 혼동하지 않기

### 5. 컴포넌트 구조
- ✅ 클립 렌더링은 `PreviewPlayer.renderClipContent` 함수 사용
- ✅ 새로운 클립 타입 추가 시 해당 함수에 케이스 추가
- ✅ UI 컴포넌트는 `components/ui`의 Radix 기반 컴포넌트 재사용
- ❌ 인라인 스타일 남발 금지 (Tailwind 클래스 우선 사용)

### 6. 파일 경로 및 리소스
- ✅ 프리셋 에셋은 `/assets/` 경로 사용 (public 디렉토리 기준)
- ✅ 환경별 리소스 경로는 `src/lib/config.ts`의 `RESOURCE_BASE_PATH` 사용 (`process.env.NEXT_PUBLIC_RESOURCE_BASE_PATH`로 설정 가능)
- ✅ 사용자 업로드 파일은 Data URL 또는 Blob URL 사용
- ✅ SVG 템플릿은 `public/data/templates.json`에 정의
- ❌ 절대 경로나 외부 URL 하드코딩 금지

### 7. 성능 최적화
- ✅ 재생 중 `requestAnimationFrame` 사용
- ✅ 불필요한 리렌더링 방지를 위해 Zustand selector 활용
- ✅ 큰 파일 처리 시 로딩 인디케이터 표시
- ❌ 동기 작업으로 UI 블로킹 금지

### 8. 에러 처리
- ✅ 미디어 로드 실패 시 폴백 처리
- ✅ API 호출 시 try-catch 사용
- ✅ 사용자에게 명확한 에러 메시지 제공
- ❌ 콘솔 에러만 남기고 무시하지 않기

### 9. TypeScript 타입 안전성
- ✅ `Clip`, `Track` 인터페이스 준수
- ✅ 옵셔널 속성 체크 (예: `clip.crop?.x`)
- ✅ 타입 가드 사용 (`clip.type === 'image'` 체크 후 `clip.crop` 사용)
- ❌ `any` 타입 남용 금지

### 10. 코드 스타일
- ✅ Prettier/ESLint 설정 준수
- ✅ 함수형 컴포넌트 및 React Hooks 사용
- ✅ 명확하고 설명적인 변수/함수명 사용 (한글 주석 가능)
- ❌ 클래스 컴포넌트 사용 금지

### 11. 문서작성 동기화
- ✅ AI_ENGINEERING_CONTRACT.md 파일에 추가해야할 사항이나 수정해야할 사항이 생기면 바로 물어보고 수정

## 알려진 제약사항 및 이슈

### 제약사항
2. **브라우저 제약**: FFmpeg.wasm 사용으로 인한 메모리 제한 (큰 프로젝트 처리 시 주의)
3. **크롭 제한**: 이미지/비디오 크롭 후 추가 변형 시 좌표 계산 복잡성


## 개발 워크플로우

### 로컬 개발
```bash
npm run dev  # http://localhost:3000에서 개발 서버 실행
```

### 새 기능 추가 시 체크리스트
1. [ ] 필요한 타입 정의를 `useStore.ts`에 추가
2. [ ] 스토어 액션 함수 구현
3. [ ] UI 컴포넌트 작성 (기존 컴포넌트 재사용 우선)
4. [ ] `PreviewPlayer`에 렌더링 로직 추가 (필요 시)
5. [ ] 편집 모달에 에디터 추가 (필요 시)
6. [ ] 프로젝트 저장/불러오기 호환성 확인
7. [ ] 다양한 시나리오 테스트 (타임라인 이동, 클립 추가/삭제, 변형 등)

## 참고 리소스

### 프로젝트 특정 파일
- `public/data/templates.json`: 템플릿 정의 참조
- `public/data/assets.json`: 프리셋 에셋 참조
- `src/features/editor/store/useStore.ts`: 전체 데이터 모델 및 상태 관리 로직

---

**최종 업데이트**: 2026-02-12
**버전**: 0.1.0

# 각 소스는 다른 agent가 참조할수 있고 또 내가 보고 판단할수 있도록 한글로 주석을 추가해줘
# 읽고난 다음 답변은 'OK'만 해줘
